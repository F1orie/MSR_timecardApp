/*
  【データ削除用SQLスクリプト】
  
  SupabaseのSQL Editorで実行してください。
  特定のユーザーや企業（部署）を削除するためのコマンドです。
  
  ※注意1: 
  'auth.users'（ログインユーザー本体）を削除すると、紐付いているプロフィールや勤怠など
  すべてのデータが自動的に削除（カスケード削除）されます。
  
  ※注意2:
  ユーザー削除はSupabaseダッシュボードの「Authentication > Users」から行うのが一番確実ですが、
  SQLで行いたい場合は以下を使用し、権限エラーが出る場合はダッシュボードを使ってください。
*/

--------------------------------------------------------------
-- 1. 特定のメールアドレスのユーザーを削除
--    （内部IDもすべて消えます）
--------------------------------------------------------------
-- 削除したいメールアドレスに書き換えてください
DELETE FROM auth.users 
WHERE email = 'test@example.com'; -- ここを削除したいメールアドレスに変更


--------------------------------------------------------------
-- 2. 企業（部署）の削除
--    ※ 注意: 所属しているユーザーがいると削除できません。
--    先に1のコマンドで、その企業に属するユーザーを全員削除してください。
--------------------------------------------------------------
-- 削除したい企業コード（3桁）に書き換えてください
DELETE FROM public.departments 
WHERE code = '001'; -- ここを削除したい企業コードに変更


--------------------------------------------------------------
-- 【補足】もし不整合データが残っている場合（通常は起きませんが念のため）
--------------------------------------------------------------
-- プロフィールの削除（auth.usersが消えていれば本来不要だが、強制削除用）
DELETE FROM public.profiles 
WHERE contact_email = 'test@example.com';
